<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Math Quiz Game</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #a18cd1, #fbc2eb);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: #fff;
    }
    .container {
      background: rgba(0, 0, 0, 0.5);
      padding: 2rem;
      border-radius: 1rem;
      text-align: center;
      max-width: 600px;
      width: 90%;
    }
    input, button, select {
      padding: 0.5rem;
      font-size: 1rem;
      margin: 0.5rem;
      border-radius: 0.5rem;
      border: none;
    }
    .question {
      font-size: 1.5rem;
      margin: 1rem 0;
    }
    .info, .result, .summary {
      margin: 1rem 0;
    }
    .leaderboard {
      text-align: left;
      margin-top: 1rem;
    }
    #sticker {
      font-size: 2rem;
      margin: 0.5rem;
    }
    @media (max-width: 600px) {
      .question {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <audio id="correctSound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3" preload="auto"></audio>
  <audio id="wrongSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3" preload="auto"></audio>
  <div class="container">
    <div id="setup">
      <h2>Welcome to the Math Quiz</h2>
      <input type="text" id="username" placeholder="Enter your name" required />
      <select id="mode">
        <option value="noob">Noob (15s)</option>
        <option value="pro">Pro (10s)</option>
      </select>
      <button onclick="startGame()">Start Game</button>
    </div>
    <div id="quiz" style="display:none">
      <div class="info">
        <p><strong>Player:</strong> <span id="playerName"></span></p>
        <p><strong>Score:</strong> <span id="score">0</span> | <strong>Hearts:</strong> <span id="hearts">5</span> | <strong>Timer:</strong> <span id="timer"></span></p>
      </div>
      <div id="sticker"></div>
      <div class="question" id="question"></div>
      <input type="text" id="answerInput" placeholder="Your answer" />
      <button onclick="submitAnswer()">Submit</button>
      <div class="result" id="result"></div>
    </div>
    <div id="gameOver" style="display:none">
      <h2>Game Over!</h2>
      <div class="summary" id="summary"></div>
      <div class="leaderboard" id="leaderboard"></div>
      <button onclick="location.reload()">Play Again</button>
    </div>
  </div>
  <script>
    const tables = Array.from({ length: 13 }, (_, i) => i + 1).flatMap(n => Array.from({ length: 10 }, (_, j) => `${n} x ${j + 1}`));
    const squares = Array.from({ length: 50 }, (_, i) => `${i + 1}¬≤`);
    const cubes = Array.from({ length: 30 }, (_, i) => `${i + 1}¬≥`);
    const questions = [...tables.map(q => ({ q, a: eval(q.replace('x', '*')) })),
                      ...squares.map(q => ({ q, a: (parseInt(q) ** 2) })),
                      ...cubes.map(q => ({ q, a: (parseInt(q) ** 3) }))];

    const stickers = ['üéâ', 'üëè', 'üòé', 'üî•', 'üëç', 'üåü', 'üíØ', 'üòÅ'];
    let username, mode, timer, timeLeft;
    let score = 0, hearts = 5, currentIndex = 0, correctCount = 0, incorrectCount = 0;
    let history = [];
    let shuffledQuestions = [];

    const playerNameEl = document.getElementById('playerName');
    const scoreEl = document.getElementById('score');
    const heartsEl = document.getElementById('hearts');
    const timerEl = document.getElementById('timer');
    const questionEl = document.getElementById('question');
    const answerInput = document.getElementById('answerInput');
    const resultEl = document.getElementById('result');
    const summaryEl = document.getElementById('summary');
    const leaderboardEl = document.getElementById('leaderboard');
    const stickerEl = document.getElementById('sticker');
    const correctSound = document.getElementById('correctSound');
    const wrongSound = document.getElementById('wrongSound');

    answerInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') submitAnswer();
    });

    function startGame() {
      username = document.getElementById('username').value.trim();
      mode = document.getElementById('mode').value;
      if (!username) return alert('Please enter your name.');
      document.getElementById('setup').style.display = 'none';
      document.getElementById('quiz').style.display = 'block';
      playerNameEl.textContent = username;
      shuffledQuestions = [...questions].sort(() => Math.random() - 0.5).slice(0, 100);
      nextQuestion();
    }

    function nextQuestion() {
      if (currentIndex >= shuffledQuestions.length || hearts <= 0) return endGame();
      resultEl.textContent = '';
      stickerEl.textContent = '';
      answerInput.value = '';
      const current = shuffledQuestions[currentIndex];
      questionEl.textContent = `Q${currentIndex + 1}: ${current.q}`;
      timeLeft = mode === 'pro' ? 10 : 15;
      timerEl.textContent = `${timeLeft}s`;
      clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        timerEl.textContent = `${timeLeft}s`;
        if (timeLeft <= 0) {
          clearInterval(timer);
          handleAnswer(null);
        }
      }, 1000);
    }

    function submitAnswer() {
      const answer = answerInput.value.trim();
      if (answer === '') return;
      handleAnswer(parseInt(answer));
    }

    function handleAnswer(ans) {
      clearInterval(timer);
      const current = shuffledQuestions[currentIndex];
      const isCorrect = ans === current.a;
      history.push({ question: current.q, yourAnswer: ans, correctAnswer: current.a, correct: isCorrect });
      if (isCorrect) {
        score++;
        correctCount++;
        resultEl.textContent = '‚úÖ Correct!';
        correctSound.play();
        stickerEl.textContent = stickers[Math.floor(Math.random() * stickers.length)];
      } else {
        hearts--;
        incorrectCount++;
        resultEl.textContent = `‚ùå Incorrect! Correct Answer: ${current.a}`;
        wrongSound.play();
      }
      scoreEl.textContent = score;
      heartsEl.textContent = hearts;
      currentIndex++;
      setTimeout(nextQuestion, 1000);
    }

    function endGame() {
      document.getElementById('quiz').style.display = 'none';
      document.getElementById('gameOver').style.display = 'block';
      summaryEl.innerHTML = `
        <p><strong>Final Score:</strong> ${score}</p>
        <p><strong>Correct Answers:</strong> ${correctCount}</p>
        <p><strong>Incorrect Answers:</strong> ${incorrectCount}</p>
        <p><strong>Answer History:</strong></p>
        <ul>${history.map(h => `<li>${h.question} = ${h.correctAnswer}, You: ${h.yourAnswer ?? '‚è±Ô∏è'} (${h.correct ? '‚úÖ' : '‚ùå'})</li>`).join('')}</ul>
      `;
      updateLeaderboard();
    }

    function updateLeaderboard() {
      const localKey = `quiz_scores_${username}`;
      const scores = JSON.parse(localStorage.getItem(localKey)) || [];
      scores.push({ score, date: new Date().toLocaleString() });
      scores.sort((a, b) => b.score - a.score);
      localStorage.setItem(localKey, JSON.stringify(scores.slice(0, 5)));
      leaderboardEl.innerHTML = `<h3>üèÜ Local Leaderboard (${username})</h3>
        <ol>${scores.slice(0, 5).map(s => `<li>${s.score} pts on ${s.date}</li>`).join('')}</ol>`;
    }
  </script>
</body>
</html>
